<?php
header('Content-Type: application/json');

// 1) Grab & sanitize the artistId (if any)
$artist = filter_input(INPUT_GET, 'artistId', FILTER_SANITIZE_STRING) ?? '';

// 2) Load the full archives array
$dataFile = __DIR__ . '/archives.json';
$all = is_readable($dataFile)
    ? json_decode(file_get_contents($dataFile), true)
    : [];

// 3) If an artistId was provided, filter down to only that DJ’s entries
if ($artist !== '') {
    $all = array_values(array_filter($all, function($e) use ($artist) {
        // matches URLs containing "/{artistId}-"
        return strpos($e['url'], "/{$artist}-") !== false;
    }));
}

// 4) Return the (filtered) array
echo json_encode($all);
